import 'core-js';
import { createEditor } from './lib/create';
import './lib/assets/index.scss';
import { Observable } from 'rxjs';

const bg = require('./assets/tbus-bg.png');

const imgUrl = location.origin + '/' + bg;

const editor = createEditor('#editor', {
  expandComponentLibrary: true,
  deviceWidth: '768px',
  theme: 'dark',
  uploader(type: string): string | Promise<string> | Observable<string> {
    const fileInput = document.createElement('input');
    fileInput.setAttribute('type', 'file');
    fileInput.setAttribute('accept', 'image/png, image/gif, image/jpeg, image/bmp, image/x-icon');
    fileInput.style.cssText = 'position: absolute; left: -9999px; top: -9999px; opacity: 0';
    document.body.appendChild(fileInput);
    fileInput.click();
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve('/test')
      }, 3000)
    })
  },
  // contents: document.getElementById('table').innerHTML
  contents: `<jumbotron style="background-image:url(${imgUrl});background-size:cover;background-position:center center;min-height:"><h1 style="text-align:center;color:rgb(255, 255, 255);font-size:36px">Hello, world!</h1><p style="text-align:center;color:rgb(255, 255, 255)">你好，我是 TBus 富文本编辑器。</p><p style="text-align:center;color:rgb(255, 255, 255)">等你好久了，你还好吗？</p></jumbotron><p>你也许在找一个既方便定制，又可以自由扩展的富文本编辑器？没错，你现在看到的就是。TBus 就是一个基于组件的编辑器，你可以自由定制你想要的任意效果，而不用关心富文本的底层实现。如果你觉得 TBus 默认提供的样式还不够非富，你一样可以自己扩展。总之，限制你的不是 TBus，而是你自己的想象力！</p><p>来看看当前 TBus 都有什么亮点：</p><ul><li>默认自带了足够<strong style="color:rgb(18, 150, 219)">丰富的工具</strong>，基本能满足大部分用户的需求；<br></li><li>原生支持<strong style="color:rgb(18, 150, 219)">组件化</strong>，可以<strong style="color:rgb(18, 150, 219)">任意定制</strong>自己的组件。默认自带了其它富文本较难实现的可编辑与不可编辑的功能；</li><li>强大的<strong style="color:rgb(18, 150, 219)">表格支持</strong>，你可<strong style="color:rgb(18, 150, 219)">批量操作</strong>单元格，并随意增加、删除表格内容，也可以修改表格的样式风格；</li><li><strong style="color:rgb(18, 150, 219)">实时代码高亮</strong>，其实不用 Markdown，一样可以写一份好的技术文档；</li><li>图片、视频等，自由的<strong style="color:rgb(18, 150, 219)">拖动缩放</strong>，不用再去找插件了；</li><li>丰富的组件库，伸手党也可以创造出不一样的文章。</li></ul><p>说了这么多，赶快运行起来，看一看效果：<br></p><pre lang="Typescript"><code><span style="font-weight:bold">import</span>&nbsp;{ createEditor }&nbsp;<span style="font-weight:bold">from</span>&nbsp;<span style="color:#d14">'@tanbo/tbus'</span>;<br><br><span style="font-weight:bold">const</span>&nbsp;editor = createEditor(<span style="color:#0086b3">document</span>.getElementById(<span style="color:#d14">'editor'</span>));<br>editor.onChange.subscribe(() =&gt; {<br>&nbsp;&nbsp;<span style="font-weight:bold">const</span>&nbsp;{contents, styleSheets} = editor.getContents();<br>&nbsp;&nbsp;<span style="color:#0086b3">console</span>.log(contents, styleSheets);<br>})<br></code></pre><p><br></p><p>你也许会好奇，TBus 到底是如何做到这么多功能的，这其实依赖于 TBus 底层的数据结构，我们来看一个表格，帮助你理解：</p><p><br></p><table><tbody><tr><td rowSpan="3" style="background-color:rgb(233, 234, 236);text-align:center"><strong style="color:rgb(28, 40, 56)">文字内容</strong><br></td><td colSpan="23"><u>你好，我是&nbsp;<strong>T</strong></u><strong>Bus 富<del>文本<em>编辑</em></del><em>器</em></strong><em>。你<u>还好</u></em><u>吗？</u><br></td></tr><tr><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">0</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">1</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">2</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">3</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">4</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">5</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">6</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">7</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">8</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">9</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">10</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">11</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">12</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">13</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">14</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">15</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">16</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">17</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">18</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">19</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">20</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">21</span><br></td><td style="background-color:rgb(73, 80, 96);text-align:center;border-color:rgb(28, 40, 56)"><span style="color:rgb(233, 234, 236);font-size:14px">22</span><br></td></tr><tr><td style="text-align:center">你<br></td><td style="text-align:center">好<br></td><td style="text-align:center">，<br></td><td style="text-align:center">我<br></td><td style="text-align:center">是<br></td><td style="text-align:center">&nbsp;<br></td><td style="text-align:center">T<br></td><td style="text-align:center">B<br></td><td style="text-align:center">u<br></td><td style="text-align:center">s<br></td><td style="text-align:center">&nbsp;<br></td><td style="text-align:center">富<br></td><td style="text-align:center">文<br></td><td style="text-align:center">本<br></td><td style="text-align:center">编<br></td><td style="text-align:center">辑<br></td><td style="text-align:center">器<br></td><td style="text-align:center">。<br></td><td style="text-align:center">你<br></td><td style="text-align:center">还<br></td><td style="text-align:center">好<br></td><td style="text-align:center">吗<br></td><td style="text-align:center">？<br></td></tr><tr><td style="background-color:rgb(233, 234, 236);text-align:center"><strong style="color:rgb(28, 40, 56)">加粗</strong><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td></tr><tr><td style="background-color:rgb(233, 234, 236);text-align:center"><strong style="color:rgb(28, 40, 56)">下划线</strong><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td></tr><tr><td style="background-color:rgb(233, 234, 236);text-align:center"><strong style="color:rgb(28, 40, 56)">斜体</strong><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td><br></td><td><br></td><td><br></td><td><br></td></tr><tr><td style="background-color:rgb(233, 234, 236);text-align:center"><strong style="color:rgb(28, 40, 56)">中划线</strong><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td style="background-color:rgb(221, 222, 225)"><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td><td><br></td></tr></tbody></table><p><br></p><p>我们操作 TBus 设置格式，实际上是操作的这些数据。TBus 会根据这些数据，自动生成最优化的 DOM。如果你还期待更多的功能，我们目前正在开发的有这些：</p><blockquote><ol><li>涂鸦板组件</li><li>公式编辑器组件</li><li>幻灯片组件<br></li></ol></blockquote><p>你还可以加入我们的官方 QQ 群，和核心开发人员直接提出需求，我们会尽最大努力满足：</p><p style="text-align:center"><img src="#" style="width:252px;height:auto"></p><p>好了，简单的介绍就到这里为止吧，希望你使用愉快！</p><p><br></p><p style="text-align:right">——TBus 开发团队</p><p style="text-align:right">2022 年 7 月 19 日<br></p>`
});

editor.onReady.subscribe(() => {
  console.log(editor.getContents().contents)
})

document.getElementById('btn').addEventListener('click', () => {
  editor.destroy();
})
// editor.setContents(`<h1>TBus&nbsp;<span style="font-weight: normal;"><span style="letter-spacing: 5px;">富文本编</span></span><span style="letter-spacing: 5px;">辑器</span></h1>`);
